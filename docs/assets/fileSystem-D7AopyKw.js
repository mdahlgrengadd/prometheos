var F=Object.defineProperty;var O=(l,e,t)=>e in l?F(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var m=(l,e,t)=>O(l,typeof e!="symbol"?e+"":e,t);import{K as w}from"./index-CJgcV1CL.js";class I{constructor(e){m(this,"root",[]);e&&(this.root=e)}readFile(e){const t=this.findItemByPath(e);return t&&t.type==="file"?t.content:void 0}writeFile(e,t){const o=this.findItemByPath(e);o&&o.type==="file"&&(o.content=t)}listDir(e){const t=this.findItemByPath(e);return t&&t.type==="folder"&&t.children?t.children:[]}deleteFile(e){}initFromData(e){this.root=e}serialize(){return JSON.parse(JSON.stringify(this.root))}findById(e){const t=o=>{for(const n of o){if(n.id===e)return n;if(n.children){const r=t(n.children);if(r)return r}}};return t(this.root)}listChildrenById(e){const t=this.findById(e);return t&&t.type==="folder"&&t.children?t.children:[]}findItemByPath(e){if(!e||e==="/")return{type:"folder",name:"/",id:"root",children:this.root};const t=e.split("/").filter(Boolean);let o={type:"folder",name:"/",id:"root",children:this.root};for(const n of t){if(!o||o.type!=="folder"||!o.children)return;o=o.children.find(r=>r.name===n)}return o}}const B=new I;function J(l){const e={};for(const o of l){const n=o.id.split("/");let r=e,s="";for(let f=0;f<n.length;f++){const i=n[f];s=s?`${s}/${i}`:i,f===n.length-1?r[i]={...o,name:i,id:s}:(r[i]||(r[i]={id:s,name:i,type:"folder",children:{}}),r[i].children||(r[i].children={}),r=r[i].children)}}function t(o){return Object.values(o).map(n=>n.type==="folder"?{...n,children:t(n.children)}:n)}return t(e)}async function N(){try{const e=await fetch("/prometheos/shadow-manifest.json");if(!e.ok)throw new Error("Failed to load shadow-manifest.json");const t=await e.json(),o=await Promise.all(t.map(async n=>{if(n.type==="file"){const r=n.contentPath,f=await(await fetch(r)).text();let i;return n.name.endsWith(".js")||n.name.endsWith(".jsx")?i="javascript":n.name.endsWith(".ts")||n.name.endsWith(".tsx")?i="typescript":n.name.endsWith(".css")?i="css":n.name.endsWith(".html")?i="html":n.name.endsWith(".json")&&(i="json"),{id:n.id,name:n.name,type:"file",content:f,language:i}}return{id:n.id,name:n.name,type:"folder",children:[]}}));return J(o)}catch(l){return console.error("Failed to load shadow folder:",l),[]}}function S(l,e){if(l.id===e)return l;if(l.children)for(const t of l.children){const o=S(t,e);if(o)return o}return null}function j(l){const e=g.getState(),t=S(e.fs,l);return t&&t.type==="file"?t.content||"":null}const g=w(l=>({fs:{id:"root",name:"My Computer",type:"folder",children:[]},init:async()=>{const e=await N();l({fs:{id:"root",name:"My Computer",type:"folder",children:e}})},addItems:(e,t)=>l(o=>{var s;const n=JSON.parse(JSON.stringify(o.fs));let r=n;for(let f=1;f<e.length;f++){const i=(s=r.children)==null?void 0:s.find(c=>c.id===e[f]);if(!i)return{fs:n};r=i}return r.children=[...r.children||[],...t],{fs:n}}),renameItem:(e,t,o)=>l(n=>{var i,c;const r=JSON.parse(JSON.stringify(n.fs));let s=r;for(let d=1;d<e.length;d++){const h=(i=s.children)==null?void 0:i.find(u=>u.id===e[d]);if(!h)return{fs:r};s=h}const f=(c=s.children)==null?void 0:c.find(d=>d.id===t);return f&&(f.name=o),{fs:r}}),deleteItem:(e,t)=>l(o=>{var s,f;const n=JSON.parse(JSON.stringify(o.fs));let r=n;for(let i=1;i<e.length;i++){const c=(s=r.children)==null?void 0:s.find(d=>d.id===e[i]);if(!c)return{fs:n};r=c}return r.children=(f=r.children)==null?void 0:f.filter(i=>i.id!==t),{fs:n}}),moveItem:(e,t,o)=>l(n=>{var c,d,h,u;const r=JSON.parse(JSON.stringify(n.fs));let s=r;for(let a=1;a<e.length;a++){const y=(c=s.children)==null?void 0:c.find(p=>p.id===e[a]);if(!y)return{fs:r};s=y}const f=(d=s.children)==null?void 0:d.find(a=>a.id===t);if(!f)return{fs:r};s.children=(h=s.children)==null?void 0:h.filter(a=>a.id!==t);let i=r;for(let a=1;a<o.length;a++){const y=(u=i.children)==null?void 0:u.find(p=>p.id===o[a]);if(!y)return{fs:r};i=y}return i.children=[...i.children||[],f],{fs:r}}),updateFileContent:(e,t,o)=>l(n=>{var i,c;const r=JSON.parse(JSON.stringify(n.fs));let s=r;for(let d=1;d<e.length;d++){const h=(i=s.children)==null?void 0:i.find(u=>u.id===e[d]);if(!h)return{fs:r};s=h}const f=(c=s.children)==null?void 0:c.find(d=>d.id===t);return f&&f.type==="file"&&(f.content=o),{fs:r}})})),W=Object.freeze(Object.defineProperty({__proto__:null,getFileContent:j,useFileSystemStore:g},Symbol.toStringTag,{value:"Module"}));export{I as V,W as f,g as u,B as v};
