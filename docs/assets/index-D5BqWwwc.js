import{c as J,i as Ze,r as o,R as ne,J as Je,j as t,h as z}from"./index-CJgcV1CL.js";import{u as Y}from"./fileSystem-D7AopyKw.js";import{af as Qe,ag as et,ah as tt,c as st,C as le,j as nt,ai as we}from"./MacroContext-Bl5Rj96v.js";import{ideSettings as ce}from"./esbuild-settings-Bzyyd_qg.js";import{F as re,S as rt}from"./settings-CcDkSBSC.js";import{F as at}from"./file-text-7ucqGkY9.js";import{T as ot,D as lt,P as ct}from"./trash-2-Di8wB0oR.js";import{H as Ne}from"./house-0ckzfVwk.js";import{R as it}from"./refresh-cw-DuWRXUjL.js";import{U as ut}from"./upload-B2902ugY.js";import"./monaco-editor-Dq6WuQlL.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=J("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=J("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=J("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=J("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=J("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=J("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);var se={boxFlex:!0,boxFlexGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0};function gt(s,n){return s+n.charAt(0).toUpperCase()+n.substring(1)}var bt=["Webkit","ms","Moz","O"];Object.keys(se).forEach(function(s){bt.forEach(function(n){se[gt(n,s)]=se[s]})});var yt={isUnitlessNumber:se},vt=yt,wt=/^ms-/,jt=/([A-Z])/g;function St(s){return s.replace(jt,"-$1").toLowerCase()}function Ct(s){return St(s).replace(wt,"-ms-")}var Nt=Ct,kt=vt.isUnitlessNumber,Et=Nt,Dt=Array.isArray,je=Object.keys,Pt=/^(normal|none|(\b(url\([^)]*\)|chapter_counter|attr\([^)]*\)|(no-)?(open|close)-quote|inherit)((\b\s*)|$|\s+))+)$/;function Se(s,n){return!kt[s]&&typeof n=="number"?n=""+n+"px":s==="content"&&!Pt.test(n)&&(n="'"+n.replace(/'/g,"\\'")+"'"),Et(s)+": "+n+";  "}function Rt(s){var n="";if(!s||je(s).length===0)return n;for(var c=je(s),l=0,h=c.length;l<h;l++){var d=c[l],p=s[d];if(Dt(p))for(var u=0,x=p.length;u<x;u++)n+=Se(d,p[u]);else n+=Se(d,p)}return n}var Mt=Rt;const Ce=Ze(Mt);function Z(){return Z=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var c=arguments[n];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(s[l]=c[l])}return s},Z.apply(this,arguments)}const Ft=["style"],$t=o.forwardRef((s,n)=>{let{style:c={}}=s,l=function(u,x){if(u==null)return{};var k,C,v={},i=Object.keys(u);for(C=0;C<i.length;C++)x.indexOf(k=i[C])>=0||(v[k]=u[k]);return v}(s,Ft);const h=o.useRef(null),d=o.useRef(null),[,p]=o.useState(0);return o.useImperativeHandle(n,()=>({getBoundingClientRect:()=>{var u;return(u=h.current)==null?void 0:u.getBoundingClientRect()},getParentBoundingClientRect:()=>{var u,x;return h==null||(u=h.current)==null||(x=u.parentElement)==null?void 0:x.getBoundingClientRect()},drawSelectionBox:u=>{requestAnimationFrame(()=>{if(d.current){const x=Z({border:"1px solid #4C85D8",background:"rgba(155, 193, 239, 0.4)",position:"absolute",pointerEvents:"none"},c,{top:u.top,left:u.left,width:u.width,height:u.height});d.current.style.cssText=Ce(x)}})},clearSelectionBox:()=>{requestAnimationFrame(()=>{d.current&&(d.current.style.cssText=Ce({top:0,left:0,width:0,height:0}))})}})),o.useEffect(()=>{p(u=>u+1)},[]),ne.createElement("div",{ref:h},h.current?Je.createPortal(ne.createElement("div",Z({ref:d},l)),h.current):null)});function At(s){return(n=>n.width*n.height)(s)>10}function Tt(s){const{onSelectionChange:n,onSelectionEnd:c,onSelectionStart:l,isEnabled:h=!0,selectionProps:d={},eventsElement:p,shouldStartSelecting:u,isValidSelectionStart:x}=s||{},k=o.useRef(null),{cancelCurrentSelection:C}=function({containerRef:v,onSelectionChange:i,onSelectionStart:b,onSelectionEnd:N,isEnabled:a=!0,eventsElement:f,shouldStartSelecting:j,isValidSelectionStart:D=At}){const P=o.useRef(null),E=o.useRef(null),R=o.useRef(!1),U=o.useRef(i),H=o.useRef(b),ee=o.useRef(N),W=o.useRef(),te=o.useRef(a);U.current=o.useCallback(w=>{W.current=i?requestAnimationFrame(()=>{i(w)}):void 0},[i]),H.current=b,ee.current=N,te.current=a;const T=o.useCallback(()=>{var w;P.current=null,E.current=null,R.current=!1,(w=v.current)==null||w.clearSelectionBox(),typeof W.current=="number"&&cancelAnimationFrame(W.current)},[v]),q=o.useCallback((w,y)=>{var $,A,_;return y||(y=(_=v.current)==null?void 0:_.getParentBoundingClientRect()),{x:w.clientX-(typeof(($=y)==null?void 0:$.left)=="number"?y.left:0),y:w.clientY-(typeof((A=y)==null?void 0:A.top)=="number"?y.top:0)}},[v]),V=o.useCallback((w,y)=>{if(P.current&&E.current){if(!y)return;const A=(({startPoint:L,endPoint:O})=>({left:Math.min(L.x,O.x),top:Math.min(L.y,O.y),width:Math.abs(L.x-O.x),height:Math.abs(L.y-O.y)}))({startPoint:P.current,endPoint:E.current}),_=Z({},A,{top:A.top+((y==null?void 0:y.top)||0),left:A.left+((y==null?void 0:y.left)||0)});var $;D(A)?(R.current||(H!=null&&H.current&&H.current(w),R.current=!0),($=v.current)==null||$.drawSelectionBox(A),U.current==null||U.current(_)):R.current&&(U.current==null||U.current(_))}else T()},[T,v]),I=o.useCallback(w=>{var y;if(!P.current)return;const $=(y=v.current)==null?void 0:y.getParentBoundingClientRect();E.current=q(w,$),V(w,$)},[V,q,v]),M=o.useCallback(w=>{var y;w.button===0&&(E.current&&(ee.current==null||ee.current(w)),T(),document.body.style.removeProperty("user-select"),document.body.style.removeProperty("-webkit-user-select"),(f||document.body).removeEventListener("mousemove",I),(y=window)==null||y.removeEventListener("mouseup",M))},[f,T,I]),F=o.useCallback(w=>{if(w.button===0&&te.current){var y;if(typeof j=="function"&&!j(w.target))return;document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",P.current=q(w),(f||document.body).addEventListener("mousemove",I),(y=window)==null||y.addEventListener("mouseup",M)}},[f,q,I,M]);return o.useEffect(()=>((f||document.body).addEventListener("mousedown",F),()=>{(f||document.body).removeEventListener("mousedown",F),(f||document.body).removeEventListener("mousemove",I),window.removeEventListener("mouseup",M)}),[f,F,I,M]),{cancelCurrentSelection:T}}({containerRef:k,onSelectionEnd:c,onSelectionStart:l,onSelectionChange:n,isEnabled:h,eventsElement:p,shouldStartSelecting:u,isValidSelectionStart:x});return{cancelCurrentSelection:C,DragSelection:o.useCallback(()=>ne.createElement($t,Z({ref:k},d)),[])}}const It=["txt","js","jsx","ts","tsx","md","css","html","json","csv","xml","yml","yaml","py","c","h","cpp","cc","hpp"],Lt=s=>{var c;switch((c=s.split(".").pop())==null?void 0:c.toLowerCase()){case"js":case"jsx":case"ts":case"tsx":case"py":case"css":case"html":case"json":case"xml":case"yml":case"yaml":case"c":case"h":case"cpp":case"cc":case"hpp":case"java":case"php":case"rb":case"go":case"rs":case"swift":case"kt":case"sh":case"bat":case"ps1":return"hybride";case"txt":case"log":case"ini":case"cfg":case"conf":return"notepad";case"md":case"markdown":case"doc":case"docx":case"rtf":return"wordeditor";case"mp3":case"wav":case"flac":case"ogg":case"m4a":case"aac":case"wma":return"audioplayer";case"htm":case"url":return"browser";default:return null}},ke=s=>{var c;if(s.type==="folder")return t.jsx(re,{className:"w-4 h-4 text-blue-500"});switch((c=s.name.split(".").pop())==null?void 0:c.toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"webp":return t.jsx(tt,{className:"w-4 h-4 text-green-500"});case"txt":case"doc":case"docx":case"pdf":case"rtf":return t.jsx(at,{className:"w-4 h-4 text-red-500"});case"mp3":case"wav":case"flac":case"ogg":return t.jsx(et,{className:"w-4 h-4 text-purple-500"});case"mp4":case"avi":case"mkv":case"mov":case"wmv":return t.jsx(xt,{className:"w-4 h-4 text-orange-500"});case"zip":case"rar":case"7z":case"tar":case"gz":return t.jsx(dt,{className:"w-4 h-4 text-yellow-500"});case"js":case"ts":case"html":case"css":case"py":case"java":case"cpp":case"c":case"php":return t.jsx(Qe,{className:"w-4 h-4 text-cyan-500"});case"exe":case"msi":case"dmg":return t.jsx(rt,{className:"w-4 h-4 text-indigo-500"});default:return t.jsx(ft,{className:"w-4 h-4 text-gray-500"})}},Ot=s=>{if(s===0)return"0 Bytes";const n=1024,c=["Bytes","KB","MB","GB","TB"],l=Math.floor(Math.log(s)/Math.log(n));return parseFloat((s/Math.pow(n,l)).toFixed(2))+" "+c[l]},ie=(s,n,c=["root"])=>{if(s.id===n)return c;if(s.children)for(const l of s.children){const h=ie(l,n,[...c,l.id]);if(h)return h}return null},zt=({position:s,itemId:n,onRename:c,onDelete:l,setShowContextMenu:h})=>t.jsxs("div",{className:"fixed bg-white border border-gray-200 rounded-lg shadow-xl py-2 z-50 min-w-48",style:{left:s.x,top:s.y},children:[t.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 transition-colors",onClick:d=>{d.stopPropagation(),c(n),h(null)},children:[t.jsx(ht,{className:"w-4 h-4"}),"Rename"]}),t.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 text-red-600 hover:bg-red-50 transition-colors",onClick:d=>{d.stopPropagation(),l(n)},children:[t.jsx(ot,{className:"w-4 h-4"}),"Delete"]})]}),Ee=({title:s,inputValue:n,onInputChange:c,onCancel:l,onKeyDown:h,children:d})=>t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:s}),t.jsx("input",{type:"text",value:n,onChange:c,onKeyDown:h,placeholder:"Enter name...",className:"w-full px-3 py-2 border border-gray-300 rounded-md mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsx("button",{onClick:l,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),d]})]})}),Bt=({newItemName:s,setNewItemName:n,setShowNewItemDialog:c,createNewItem:l,handleKeyDown:h})=>t.jsxs(Ee,{title:"Create New Item",inputValue:s,onInputChange:d=>n(d.target.value),onCancel:()=>{c(!1),n("")},onKeyDown:h,children:[t.jsx("button",{onClick:()=>l("folder"),disabled:!s.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Create Folder"}),t.jsx("button",{onClick:()=>l("file"),disabled:!s.trim(),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Create File"})]}),Ut=({newItemName:s,setNewItemName:n,setShowRenameDialog:c,renameItem:l,showRenameDialog:h})=>t.jsx(Ee,{title:"Rename Item",inputValue:s,onInputChange:d=>n(d.target.value),onCancel:()=>{c(null),n("")},onKeyDown:d=>{d.key==="Enter"&&s.trim()?l(h,s):d.key==="Escape"&&(c(null),n(""))},children:t.jsx("button",{onClick:()=>l(h,s),disabled:!s.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})}),Ht=({items:s,selectedItems:n,setSelectedItems:c,navigateToFolder:l,setShowContextMenu:h,handleDragStart:d,handleFolderDragOver:p,handleFolderDragLeave:u,handleFolderDrop:x,dragOverFolder:k,selectionBox:C,openFile:v})=>t.jsx("div",{className:"mb-8",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"1rem",alignItems:"start"},children:s.map(i=>t.jsx("div",{"data-item-id":i.id,className:`p-3 border rounded-lg cursor-pointer hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ${n.has(i.id)?"bg-blue-50 border-blue-300 shadow-sm":"border-gray-200"} ${k===i.id?"bg-blue-100 border-blue-400":""}`,onClick:b=>{if(b.stopPropagation(),b.ctrlKey||b.metaKey){const N=new Set(n);N.has(i.id)?N.delete(i.id):N.add(i.id),c(N)}else if(b.shiftKey&&n.size>0){const N=s.map(D=>D.id),a=Array.from(n).pop(),f=N.indexOf(a||""),j=N.indexOf(i.id);if(f>=0){const D=Math.min(f,j),P=Math.max(f,j),E=N.slice(D,P+1);c(new Set(E))}}else c(new Set([i.id]))},onDoubleClick:b=>{b.stopPropagation(),i.type==="folder"?l(i.id):i.type==="file"&&v&&v(i)},onContextMenu:b=>{b.preventDefault(),b.stopPropagation(),n.has(i.id)||c(new Set([i.id])),h({x:b.clientX,y:b.clientY,itemId:i.id})},draggable:!0,onDragStart:b=>d&&d(i.id,b),onDragOver:b=>i.type==="folder"&&p&&p(i.id,b),onDragLeave:()=>i.type==="folder"&&u&&u(),onDrop:b=>i.type==="folder"&&x&&x(i.id,b),children:t.jsxs("div",{className:"flex flex-col items-center text-center",children:[t.jsx("div",{className:"w-12 h-12 flex items-center justify-center mb-2",children:ne.cloneElement(ke(i),{className:`w-8 h-8 ${n.has(i.id)?"drop-shadow-sm":""}`})}),t.jsx("span",{className:"text-sm truncate w-full font-medium",title:i.name,children:i.name}),i.type==="file"&&i.size!==void 0&&t.jsx("span",{className:"text-xs text-gray-500 mt-1",children:Ot(i.size)})]})},i.id))}),Vt=({fileSystem:s,expandedFolders:n,selectedItems:c,navigateToQuickAccess:l,toggleFolder:h,setSelectedItems:d,handleFolderDragOver:p,handleFolderDragLeave:u,handleFolderDrop:x,dragOverFolder:k})=>{const C=o.useMemo(()=>{var a;return(a=s.children)==null?void 0:a.find(f=>f.name===".vfsignore"&&f.type==="file")},[s]),v=o.useMemo(()=>!C||!C.content?[]:C.content.split(/\r?\n/).map(a=>a.trim()).filter(a=>a&&!a.startsWith("#")),[C]),i=o.useMemo(()=>v.map(a=>{const f=a.endsWith("/");let D=(f?a.slice(0,-1):a).replace(/\*\*/g,".*").replace(/\*/g,"[^/]*").replace(/\?/g,".");return f&&(D=`${D}(/.*)?`),new RegExp(`^${D}$`)}),[v]),b=o.useCallback(a=>a.filter(f=>!(f.name===".vfsignore"||!ce.showHiddenFiles&&f.name.startsWith(".")||i.some(j=>j.test(f.id)))).sort((f,j)=>f.type!==j.type?f.type==="folder"?-1:1:f.name.localeCompare(j.name)),[i]),N=(a,f=0)=>{const j=n.has(a.id),D=c.has(a.id),P=a.type==="folder"&&a.children&&a.children.length>0,E=k===a.id;return t.jsxs("div",{children:[t.jsxs("div",{className:`flex items-center gap-2 py-1 px-2 hover:bg-gray-100 cursor-pointer transition-colors ${D?"bg-blue-100 text-blue-700":""} ${E?"bg-blue-100 border-blue-400":""}`,style:{paddingLeft:`${f*20+4}px`},onClick:()=>{a.type==="folder"&&(h(a.id),d(new Set([a.id])))},onDoubleClick:()=>{a.type==="folder"&&l(a.id)},onDragOver:R=>a.type==="folder"&&p&&p(a.id,R),onDragLeave:()=>a.type==="folder"&&u&&u(),onDrop:R=>a.type==="folder"&&x&&x(a.id,R),children:[a.type==="folder"&&t.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:P?j?t.jsx(st,{className:"w-3 h-3 text-gray-500"}):t.jsx(le,{className:"w-3 h-3 text-gray-500"}):t.jsx("div",{className:"w-3 h-3"})}),ke(a),t.jsx("span",{className:"text-sm truncate flex-1",children:a.name})]}),a.type==="folder"&&j&&a.children&&t.jsx("div",{children:b(a.children).map(R=>N(R,f+1))})]},a.id)};return t.jsxs("div",{className:"w-64 bg-gray-50 border-r border-gray-200 overflow-y-auto",children:[t.jsxs("div",{className:"p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Quick Access"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("button",{onClick:()=>l("desktop"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:a=>p&&p("desktop",a),onDragLeave:()=>u&&u(),onDrop:a=>x&&x("desktop",a),children:[t.jsx(Ne,{className:"w-4 h-4 text-blue-500"}),"Desktop"]}),t.jsxs("button",{onClick:()=>l("documents"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:a=>p&&p("documents",a),onDragLeave:()=>u&&u(),onDrop:a=>x&&x("documents",a),children:[t.jsx(re,{className:"w-4 h-4 text-blue-500"}),"Documents"]}),t.jsxs("button",{onClick:()=>l("downloads"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:a=>p&&p("downloads",a),onDragLeave:()=>u&&u(),onDrop:a=>x&&x("downloads",a),children:[t.jsx(lt,{className:"w-4 h-4 text-blue-500"}),"Downloads"]})]})]}),t.jsxs("div",{className:"px-4 pb-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"This PC"}),t.jsx("div",{className:"text-sm",children:N(s)})]})]})},_t=({isAuthenticated:s,user:n,handleGithubAuth:c,handleLogout:l})=>t.jsxs("div",{className:"h-8 bg-gray-900 text-white flex items-center justify-between px-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"w-4 h-4"}),t.jsx("span",{className:"font-medium",children:"File Explorer"})]}),t.jsx("div",{className:"flex items-center gap-2",children:s?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:n==null?void 0:n.avatar_url,alt:"Avatar",className:"w-5 h-5 rounded-full border border-gray-600"}),t.jsx("span",{className:"text-xs font-medium",children:n==null?void 0:n.name}),t.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-700 rounded transition-colors",title:"Sign out",children:t.jsx(mt,{className:"w-3 h-3"})})]}):t.jsxs("button",{onClick:c,className:"flex items-center gap-1 px-2 py-1 bg-gray-800 hover:bg-gray-700 rounded text-xs transition-colors",children:[t.jsx(pt,{className:"w-3 h-3"}),"Sign in with GitHub"]})})]}),Gt=({currentPath:s,breadcrumbs:n,navigateUp:c,navigateToPathLevel:l,showNewItemDialog:h,fileInputRef:d,isAuthenticated:p,handleGithubAuth:u})=>t.jsxs("div",{className:"h-12 bg-gray-50 border-b border-gray-200 flex items-center px-4 gap-2",children:[t.jsx("button",{onClick:c,disabled:s.length<=1,className:"p-2 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Go up",children:t.jsx(le,{className:"w-4 h-4 rotate-180"})}),t.jsx("button",{className:"p-2 hover:bg-gray-200 rounded transition-colors",title:"Refresh",children:t.jsx(it,{className:"w-4 h-4"})}),t.jsx("div",{className:"flex-1 mx-4",children:t.jsxs("div",{className:"flex items-center bg-white border border-gray-300 rounded px-3 py-1.5",children:[t.jsx(Ne,{className:"w-4 h-4 text-gray-400 mr-2"}),t.jsx("button",{onClick:()=>l(0),className:"text-sm hover:text-blue-600 transition-colors",children:"This PC"}),n.map((x,k)=>t.jsxs("span",{className:"flex items-center",children:[t.jsx(le,{className:"w-3 h-3 text-gray-400 mx-1"}),t.jsx("button",{onClick:()=>l(k+1),className:"text-sm text-gray-600 hover:text-blue-600 transition-colors",children:x.name})]},x.id))]})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("button",{onClick:()=>p?h():u(),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm transition-colors disabled:opacity-50",title:p?"Create new item":"Sign in to create items",children:[t.jsx(ct,{className:"w-4 h-4"}),"New"]}),t.jsx("button",{onClick:()=>{var x;return p?(x=d.current)==null?void 0:x.click():u()},className:"p-2 hover:bg-gray-200 rounded transition-colors",title:p?"Upload files":"Sign in to upload files",children:t.jsx(ut,{className:"w-4 h-4"})})]})]}),Wt=()=>{var be,ye;const[s,n]=o.useState(["root"]),[c,l]=o.useState(new Set),[h,d]=o.useState(new Set(["root"])),[p,u]=o.useState(!1),[x,k]=o.useState(null),[C,v]=o.useState(null),[i,b]=o.useState(!1),[N,a]=o.useState(null),[f,j]=o.useState(""),[D,P]=o.useState(null),[E,R]=o.useState(null),[U,H]=o.useState(null),[ee,W]=o.useState(!1),[te,T]=o.useState(!1),[q,V]=o.useState(!1),I=o.useRef(null),M=o.useRef(null),F=Y(e=>e.fs),w=Y(e=>e.init),y=Y(e=>e.addItems),$=Y(e=>e.renameItem),A=Y(e=>e.deleteItem),_=Y(e=>e.moveItem),L=nt(),O=o.useMemo(()=>{var e;return(e=F.children)==null?void 0:e.find(r=>r.name===".vfsignore"&&r.type==="file")},[F]),ue=o.useMemo(()=>!O||!O.content?[]:O.content.split(/\r?\n/).map(e=>e.trim()).filter(e=>e&&!e.startsWith("#")),[O]),de=o.useMemo(()=>ue.map(e=>{const r=e.endsWith("/");let g=(r?e.slice(0,-1):e).replace(/\*\*/g,".*").replace(/\*/g,"[^/]*").replace(/\?/g,".");return r&&(g=`${g}(/.*)?`),new RegExp(`^${g}$`)}),[ue]),fe=o.useMemo(()=>{var m;let e=F;for(let g=1;g<s.length&&(e=(m=e.children)==null?void 0:m.find(S=>S.id===s[g]),!!e);g++);return((e==null?void 0:e.children)||[]).filter(g=>!(g.name===".vfsignore"||!ce.showHiddenFiles&&g.name.startsWith(".")||de.some(S=>S.test(g.id))))},[F,s,de,ce.showHiddenFiles]),pe=o.useMemo(()=>[...fe].sort((e,r)=>e.type!==r.type?e.type==="folder"?-1:1:e.name.localeCompare(r.name)),[fe]);o.useEffect(()=>{w().then(()=>d(new Set(["root"])))},[w]);const{DragSelection:De}=Tt({onSelectionChange:Te,isEnabled:te,shouldStartSelecting:e=>{if(e instanceof HTMLElement){let r=e;for(;r&&r!==M.current;){if(r.hasAttribute("data-item-id"))return!1;r=r.parentElement}return!0}return!1},selectionProps:{style:{border:"2px solid #3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",position:"absolute",zIndex:1e3}}}),ae=o.useCallback(e=>{var m;let r=F;for(let g=1;g<e.length;g++){const S=(m=r.children)==null?void 0:m.find(K=>K.id===e[g]);if(!S)return null;r=S}return r},[F]),Pe=o.useCallback(()=>ae(s),[ae,s]),Re=o.useCallback(e=>{const r=[...s,e];n(r),l(new Set),d(m=>new Set([...m,e]))},[s]),Me=o.useCallback(()=>{s.length>1&&(n(s.slice(0,-1)),l(new Set))},[s]),Fe=o.useCallback(e=>{const r=s.slice(0,e+1);n(r),l(new Set)},[s]),$e=o.useCallback(e=>{d(r=>{const m=new Set(r);return m.has(e)?m.delete(e):m.add(e),m})},[]),Ae=o.useCallback(async e=>{if(e.type!=="file")return;const r=Lt(e.name);if(!r){z(`No default app for file type: ${e.name.split(".").pop()}`);return}try{const m=`vfs://${e.id}`;await(L==null?void 0:L.executeAction("sys","open",{name:r,initFromUrl:m})),z(`Opening ${e.name} with ${r}`)}catch(m){console.error("Failed to open file:",m),z(`Failed to open ${e.name}`)}},[L]);function Te(e){if(!M.current||!e.width||!e.height)return;H(e);const r=M.current.querySelectorAll("[data-item-id]"),m=new Set;r.forEach(g=>{const S=g.getBoundingClientRect(),K=g.getAttribute("data-item-id");if(!K)return;const X=M.current.getBoundingClientRect(),B={left:S.left-X.left,top:S.top-X.top,right:S.right-X.left,bottom:S.bottom-X.top};!(B.right<e.left||B.left>e.left+e.width||B.bottom<e.top||B.top>e.top+e.height)&&m.add(K)}),l(m)}const Ie=e=>{e.preventDefault(),V(!0)},Le=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy",V(!0)},Oe=e=>{e.preventDefault(),V(!1)},ze=async e=>{var m;e.preventDefault(),V(!1);const r=Array.from(e.dataTransfer.files);if(r.length>0&&!p&&(oe(),z.success("Auto-authenticated for file upload")),r.length>0)try{const g=[];for(const S of r){const K=((m=S.name.split(".").pop())==null?void 0:m.toLowerCase())??"",X=It.includes(K);let B;X?B=await new Promise((ve,Ye)=>{const Q=new FileReader;Q.onload=()=>ve(Q.result),Q.onerror=()=>Ye(Q.error),Q.readAsText(S)}):B="[Binary file content]",g.push({id:`file_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,name:S.name,type:"file",size:S.size,content:B})}y(s,g),z.success(`${g.length} file(s) uploaded`)}catch(g){console.error("Error uploading files:",g),z.error("Failed to upload files")}},me=e=>{if(!f.trim()||!p)return;const r={id:`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:f.trim(),type:e,...e==="folder"?{children:[]}:{size:0}};y(s,[r]),z.success(`${e==="folder"?"Folder":"File"} created`),j(""),b(!1)},Be=(e,r)=>{!r.trim()||!p||($(s,e,r.trim()),z.success("Item renamed"),a(null),j(""))},Ue=e=>{p&&(A(s,e),z.success("Item deleted"),l(new Set),v(null))},oe=()=>{u(!0),k({login:"developer-user",avatar_url:"https://github.com/github.png",name:"Developer User"})},He=()=>{u(!1),k(null),l(new Set)},Ve=e=>{const r=ie(F,e);r&&(n(r),l(new Set))},_e=e=>{e.key==="Enter"&&i&&f.trim()?me("folder"):e.key==="Escape"&&(b(!1),a(null),v(null))},Ge=()=>{v(null)},We=(e,r)=>{r.stopPropagation(),p&&(R(e),r.dataTransfer.setData("text/plain",e),r.dataTransfer.effectAllowed="move",c.has(e)||l(new Set([e])))},he=(e,r)=>{r.preventDefault(),r.stopPropagation(),E&&E!==e&&(P(e),r.dataTransfer.dropEffect="move")},xe=()=>{P(null)},ge=(e,r)=>{if(r.preventDefault(),r.stopPropagation(),P(null),!E||!p||E===e)return;const m=ie(F,e);m&&(_(s,E,m),R(null))},qe=e=>{if(e.target===M.current||e.target===e.currentTarget)T(!0);else{let r=e.target,m=!1;for(;r&&r!==M.current;){if(r.hasAttribute("data-item-id")){m=!0;break}r=r.parentElement}m||T(!0)}W(!0)},Ke=()=>{W(!1),T(!1),H(null)},G=Pe(),Xe=s.slice(1).reduce((e,r,m)=>{const g=s.slice(0,m+2),S=ae(g);return S&&e.push({id:r,name:S.name,path:g}),e},[]);return t.jsxs("div",{className:"h-screen flex flex-col bg-white",onClick:Ge,children:[t.jsx(_t,{isAuthenticated:p,user:x,handleGithubAuth:oe,handleLogout:He}),t.jsx(Gt,{currentPath:s,breadcrumbs:Xe,navigateUp:Me,navigateToPathLevel:Fe,showNewItemDialog:()=>b(!0),fileInputRef:I,isAuthenticated:p,handleGithubAuth:oe}),t.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[t.jsx(Vt,{fileSystem:F,expandedFolders:h,selectedItems:c,navigateToQuickAccess:Ve,toggleFolder:$e,setSelectedItems:l,handleFolderDragOver:he,handleFolderDragLeave:xe,handleFolderDrop:ge,dragOverFolder:D}),t.jsxs("div",{className:`flex-1 p-6 overflow-y-auto bg-white transition-colors duration-200 relative border-2 border-dashed ${q?"border-blue-400 bg-blue-50":"border-transparent"}`,onDragEnter:Ie,onDragOver:Le,onDragLeave:Oe,onDrop:ze,onMouseDown:qe,onMouseUp:Ke,ref:M,children:[t.jsx(De,{}),G&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-1",children:G.name}),t.jsxs("p",{className:"text-sm text-gray-500",children:[((be=G.children)==null?void 0:be.length)||0," item",(((ye=G.children)==null?void 0:ye.length)||0)!==1?"s":""]})]}),pe.length>0?t.jsx(Ht,{items:pe,selectedItems:c,setSelectedItems:l,navigateToFolder:Re,setShowContextMenu:v,handleDragStart:We,handleFolderDragOver:he,handleFolderDragLeave:xe,handleFolderDrop:ge,dragOverFolder:D,selectionBox:U,openFile:Ae}):t.jsxs("div",{className:"text-center text-gray-500 mb-8",children:[t.jsx(re,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"This folder is empty"})]})]})]})]}),t.jsx("input",{type:"file",ref:I,multiple:!0,className:"hidden",onChange:e=>{const r=Array.from(e.target.files||[]);console.log("Files selected for upload:",r)}}),C&&t.jsx(zt,{position:{x:C.x,y:C.y},itemId:C.itemId,onRename:e=>{var m;const r=(m=G==null?void 0:G.children)==null?void 0:m.find(g=>g.id===e);r&&(j(r.name),a(e))},onDelete:Ue,setShowContextMenu:v}),i&&t.jsx(Bt,{newItemName:f,setNewItemName:j,setShowNewItemDialog:b,createNewItem:me,handleKeyDown:_e}),N&&t.jsx(Ut,{newItemName:f,setNewItemName:j,setShowRenameDialog:a,renameItem:Be,showRenameDialog:N})]})},rs={id:we.id,manifest:we,init:async()=>{},render:()=>t.jsx(Wt,{}),onOpen:()=>{},onClose:()=>{}};export{rs as default};
