import{j as e,r as t,e as a,g as n}from"./index-CM0htoqd.js";import{a9 as r}from"./MacroContext-EXPiZfro.js";import"./monaco-editor-Ch9pnC_y.js";const s=()=>{if(!document.getElementById("webamp-css-preload")){const e=document.createElement("link");e.id="webamp-css-preload",e.rel="stylesheet",e.href="https://unpkg.com/webamp@1.5.0/built/webamp.css",document.head.appendChild(e)}},i=()=>{const i=t.useRef(null),[o,l]=t.useState(!1),[c,m]=t.useState([]),p=t.useRef(null),d=t.useRef([]),u=a((e=>e.setOpen)),b=a((e=>e.minimize));t.useEffect((()=>{if(s(),window.Webamp||document.getElementById("webamp-script"))window.Webamp&&l(!0);else{const e=document.createElement("script");e.id="webamp-script",e.src="https://unpkg.com/webamp@1.5.0/built/webamp.bundle.min.js",e.async=!0,e.onload=()=>l(!0),document.body.appendChild(e)}}),[]),t.useEffect((()=>()=>{d.current.forEach((e=>e())),d.current=[]}),[]),t.useEffect((()=>{if(o&&i.current&&!p.current)try{const e={zIndex:1e3,initialTracks:c.length>0?c:[{metaData:{artist:"DJ Mike Llama",title:"Llama Whippin' Intro"},url:"https://cdn.jsdelivr.net/gh/captbaritone/webamp@43434d82/mp3/llama-2.91.mp3",duration:5.322286}]},t=new window.Webamp(e);p.current=t;const a=t.onClose((()=>{u("webamp",!1)})),r=t.onMinimize((()=>{b("webamp",!0)})),s=t.onTrackDidChange((e=>{if(null==e?void 0:e.metaData){const{artist:t,title:a}=e.metaData;n.emit("webamp:trackChanged",e,t,a)}}));d.current.push(a,r,s),window.WebampGlobal=t,t.renderWhenReady(i.current);const o=n.subscribe("webamp:play",(()=>t.play())),l=n.subscribe("webamp:pause",(()=>t.pause())),m=n.subscribe("webamp:stop",(()=>t.stop())),w=n.subscribe("webamp:next",(()=>{const e=t.store.getState(),a=e.playlist||{},n=e.tracks||[],r=a.currentTrack||0;r<n.length-1&&t.store.dispatch({type:"SET_CURRENT_TRACK",trackId:r+1})})),h=n.subscribe("webamp:prev",(()=>{const e=(t.store.getState().playlist||{}).currentTrack||0;e>0&&t.store.dispatch({type:"SET_CURRENT_TRACK",trackId:e-1})})),f=n.subscribe("webamp:loadTrack",((e,a,n)=>{t.setTracksToPlay([{url:e,metaData:{artist:n,title:a}}])}));return d.current.push(o,l,m,f,w,h),()=>{try{d.current.forEach((e=>e())),d.current=[],t.dispose(),delete window.WebampGlobal,p.current=null}catch(e){}}}catch(e){}}),[o,u,b]),t.useEffect((()=>{c.length>0&&p.current&&p.current.setTracksToPlay(c)}),[c]);const w=t.useCallback((e=>{e.preventDefault();const t=Array.from(e.dataTransfer.files).filter((e=>e.type.startsWith("audio/")));if(t.length>0){const e=t.map((e=>({blob:e,metaData:{title:e.name.replace(/\.[^/.]+$/,"")}})));m(e)}}),[]),h=!0===r.frameless;return e.jsx("div",{className:"h-full w-full flex flex-col items-center justify-center "+(h?"":"bg-gray-800 text-white overflow-hidden"),style:h?{backgroundColor:"transparent"}:{},onDrop:w,onDragOver:e=>e.preventDefault(),children:o?e.jsx("div",{className:"w-full h-full",ref:i}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-t-2 border-blue-500 rounded-full mx-auto mb-4"}),e.jsx("p",{children:"Loading Webamp..."})]})})},o={id:r.id,manifest:r,init:async()=>{const e=document.createElement("style");e.id="webamp-global-styles",e.innerHTML="\n      #webamp {\n        position: relative;\n        z-index: 50;\n      }\n      .webamp-context-menu {\n        z-index: 1000;\n      }\n      /* Disable theme window pseudo-element in Webamp container */\n      #webamp .window::before {\n        display: none !important;\n      }\n\n      /* Fix equalizer-top sizing under Win7 theme */\n      .theme-win7 #webamp .equalizer-top {\n        height: 0px !important;\n        width: 0px !important;\n      }\n    ",document.head.appendChild(e),s()},onDestroy:()=>{const e=document.getElementById("webamp-global-styles");e&&e.remove();const t=document.getElementById("webamp-css-preload");t&&t.remove()},render:()=>e.jsx(i,{})};export{o as default};
