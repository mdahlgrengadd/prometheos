import{c as e,r as t,a as s,j as i,e as n}from"./index-CM0htoqd.js";import{u as l,a,C as r,A as c,M as o,P as d}from"./MacroContext-EXPiZfro.js";import{H as u}from"./house-DOhvFSai.js";import"./monaco-editor-Ch9pnC_y.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=e("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),h=e("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),p=e("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),x=({setActiveApp:e})=>{const{pluginManager:s,openWindow:i}=l();return t.useEffect((()=>{const t=a();if(t.length>0){const s=t[0],n=setTimeout((()=>{try{i(s.appId,s.initFromUrl),e(s.appId)}catch(t){}}),10);return()=>clearTimeout(n)}}),[e,s,i]),t.useEffect((()=>{const t=()=>{const t=a();if(t.length>0){const s=t[0];i(s.appId,s.initFromUrl),e(s.appId)}};return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)}),[e,i]),null},f=({plugin:e,closeApp:t})=>{const{padding:n}=s();return e?i.jsxs("div",{className:"fixed inset-0 z-50 bg-white animate-fade-in flex flex-col",children:[i.jsxs("div",{className:"mobile-app-header px-4 py-3 flex items-center bg-gradient-to-r from-purple-500 to-blue-600",children:[i.jsx("button",{onClick:t,className:"p-1 rounded-full bg-white/20 transition-transform active:scale-90","aria-label":"Back to home screen",children:i.jsx(m,{className:"text-white",size:20})}),i.jsx("h1",{className:"ml-4 text-white font-semibold text-xl",children:e.manifest.name})]}),i.jsx("div",{className:"flex-1 overflow-auto",children:i.jsx("div",{className:"window-content h-full",style:{minHeight:"100%",paddingTop:`${n}px`,paddingRight:`${n}px`,paddingBottom:`${n}px`,paddingLeft:`${n}px`},children:e.render()})})]}):null},g=({plugins:e,activeApp:t,openApp:s})=>i.jsxs("div",{className:"fixed bottom-0 inset-x-0 h-20 bg-black/10 backdrop-blur-md z-50 flex items-center justify-around px-6",children:[i.jsx("button",{className:"flex flex-col items-center justify-center",onClick:()=>t&&s(t),children:i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center "+(t?"bg-white/10":"bg-white/20"),children:i.jsx(u,{size:24,className:""+(t?"text-white/70":"text-white")})})}),e.map((e=>i.jsx("button",{className:"flex flex-col items-center justify-center",onClick:()=>s(e.id),children:i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center "+(t===e.id?"bg-white/20":"bg-white/10"),children:i.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center",children:"string"==typeof e.manifest.icon?i.jsx("span",{className:"text-white font-medium text-xs",children:e.manifest.name.substring(0,2)}):i.jsx("div",{className:"text-white scale-75",children:e.manifest.icon})})})},e.id))),i.jsx("button",{className:"flex flex-col items-center justify-center",onClick:()=>t&&s(t),children:i.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center",children:i.jsx(p,{size:24,className:"text-white/70"})})})]}),v=({plugins:e,pluginPages:s,currentHomeScreen:n,setCurrentHomeScreen:l,openApp:a})=>{const[c,o]=t.useState(null),[d,u]=t.useState(null);return i.jsxs("div",{className:"relative h-full w-full flex flex-col",onTouchStart:e=>{o(e.targetTouches[0].clientX)},onTouchMove:e=>{u(e.targetTouches[0].clientX)},onTouchEnd:()=>{if(!c||!d)return;const e=c-d,t=e<-50;e>50&&n<s.length-1&&l(n+1),t&&n>0&&l(n-1),o(null),u(null)},children:[i.jsxs("div",{className:"p-4 flex justify-between items-center",children:[i.jsx("div",{className:"text-sm font-medium text-white",children:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("div",{className:"w-4 h-4 bg-white/20 rounded-full"}),i.jsx("div",{className:"w-4 h-4 bg-white/20 rounded-full"}),i.jsx("div",{className:"w-4 h-4 bg-white/20 rounded-full"})]})]}),i.jsx("div",{className:"flex-grow flex items-center justify-center pb-16",children:(()=>{const t=9*n,s=t+9,l=e.slice(t,s),r=l.length<9?[...l,...Array(9-l.length).fill(null)]:l;return i.jsx("div",{className:"grid grid-cols-3 gap-4 p-4 overflow-y-auto",children:r.map(((e,t)=>{var s,n,l,r;return i.jsxs("div",{className:"flex flex-col items-center",onClick:()=>e&&e.id&&a(e.id),style:{cursor:e&&e.id?"pointer":"default",opacity:e&&e.id?1:.5},children:[i.jsx("div",{className:"w-16 h-16 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-sm",children:i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-lg flex items-center justify-center overflow-hidden",children:(null==(s=null==e?void 0:e.manifest)?void 0:s.icon)?e.manifest.icon:(null==(n=null==e?void 0:e.manifest)?void 0:n.iconUrl)?i.jsx("img",{src:e.manifest.iconUrl,alt:e.manifest.name||"App",className:"w-8 h-8 object-contain",draggable:!1}):(null==(l=null==e?void 0:e.manifest)?void 0:l.name)?i.jsx("span",{className:"text-white font-bold",children:e.manifest.name.charAt(0)}):(null==e?void 0:e.id)?i.jsx("span",{className:"text-white font-bold",children:e.id.charAt(0).toUpperCase()}):i.jsx("span",{className:"text-white font-bold opacity-50",children:"?"})})}),i.jsx("span",{className:"mt-2 text-xs text-white font-medium text-center max-w-[4.5rem] truncate",children:(null==(r=null==e?void 0:e.manifest)?void 0:r.name)||(null==e?void 0:e.id)||""})]},(null==e?void 0:e.id)??t)}))})})()}),i.jsx("div",{className:"flex justify-center pb-24",children:i.jsx("div",{className:"flex space-x-2",children:s.map(((e,t)=>i.jsx("div",{className:"w-2 h-2 rounded-full "+(t===n?"bg-white":"bg-white/30")},t)))})}),s.length>1&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute inset-y-0 left-2 flex items-center sm:hidden",children:n>0&&i.jsx("button",{onClick:()=>{n>0&&l(n-1)},className:"p-2 rounded-full bg-white/20 backdrop-blur-sm",children:i.jsx(h,{className:"text-white"})})}),i.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center sm:hidden",children:n<s.length-1&&i.jsx("button",{onClick:()=>{n<s.length-1&&l(n+1)},className:"p-2 rounded-full bg-white/20 backdrop-blur-sm",children:i.jsx(r,{className:"text-white"})})})]})]})},w=({activeApp:e,setActiveApp:a})=>{const{loadedPlugins:r,pluginManager:c,openWindow:o}=l(),{wallpaper:d,backgroundColor:u}=s(),[m,h]=t.useState(0),p=n((e=>e.windows));t.useEffect((()=>{const e=document.createElement("meta");e.name="viewport",e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover",document.head.appendChild(e);const t=()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)};return window.addEventListener("resize",t),window.addEventListener("orientationchange",t),t(),()=>{document.head.removeChild(e),window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}}),[]);const x=t.useMemo((()=>{const e=[...c.getAllPlugins()||[],...Array.isArray(r)?r:Object.values(r||{}),...Object.values(p||{}).map((e=>({id:e.id,manifest:{name:e.title,icon:e.icon,iconUrl:"string"==typeof e.icon?e.icon:void 0}})))],t=new Map;return e.forEach((e=>{if(e&&e.id){const s=t.get(e.id);(!s||!s.manifest&&e.manifest)&&t.set(e.id,e)}})),Array.from(t.values())}),[c,r,p]),w=t.useMemo((()=>{const e=[];for(let t=0;t<x.length;t+=8)e.push(x.slice(t,t+8));return e.length>0?e:[[]]}),[x]),j=e=>{o(e),a(e)},b=d?{backgroundImage:`url(${d})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{backgroundColor:u};return i.jsxs("div",{className:"relative w-full h-screen overflow-auto",style:{height:"var(--app-height, 100vh)",...b},children:[!e&&i.jsx(v,{plugins:x,pluginPages:w,currentHomeScreen:m,setCurrentHomeScreen:h,openApp:j}),e&&i.jsx(f,{plugin:r.find((t=>t.id===e)),closeApp:()=>{a(null)}}),i.jsx("div",{style:{opacity:e?0:1,visibility:e?"hidden":"visible",transition:"opacity 0.3s ease, visibility 0.3s ease",zIndex:e?10:50},children:i.jsx(g,{plugins:x.slice(0,4),activeApp:e,openApp:j})})]})},j=()=>{const[e,s]=t.useState(null);return t.useEffect((()=>{if(!(()=>{const e="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return e&&t})())return;setTimeout((()=>{(async()=>{try{const e=document.documentElement;e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen?await e.mozRequestFullScreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}catch(e){}})()}),1e3)}),[]),i.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[i.jsx(x,{setActiveApp:s}),i.jsx(w,{activeApp:e,setActiveApp:s})]})},b=()=>i.jsx(c,{children:i.jsx(o,{children:i.jsx(d,{children:i.jsx(j,{})})})});
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{b as default};
