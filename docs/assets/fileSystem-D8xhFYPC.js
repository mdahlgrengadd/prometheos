var t=Object.defineProperty,e=(e,i,n)=>((e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n)(e,"symbol"!=typeof i?i+"":i,n);import{K as i,g as n}from"./index-CM0htoqd.js";class o{constructor(t){e(this,"root",[]),e(this,"initialized",!1),e(this,"initPromise",null),t&&(this.root=t,this.initialized=!0)}isInitialized(){return this.initialized}async initializeOnce(){if(!this.initialized){if(this.initPromise)return this.initPromise;this.initPromise=this.loadFromShadow(),await this.initPromise,this.initialized=!0,this.initPromise=null}}async forceReloadFromShadow(){this.initialized=!1,this.initPromise=null,await this.initializeOnce()}async loadFromShadow(){const t=await async function(){try{const t="/prometheos/shadow-manifest.json",e=await fetch(t);if(!e.ok)throw new Error("Failed to load shadow-manifest.json");const i=await e.json(),n=new Set;for(const s of i)if("file"===s.type){const t=s.id.split("/");for(let e=1;e<t.length;e++){const i=t.slice(0,e).join("/");n.add(i)}}const o=Array.from(n).map((t=>({id:t,name:t.split("/").pop()||t,type:"folder",children:[]}))),r=await Promise.all(i.filter((t=>"file"===t.type&&"empty.txt"!==t.name)).map((async t=>{const e=t.contentPath,i=await fetch(e),n=await i.text();let o;return t.name.endsWith(".js")||t.name.endsWith(".jsx")?o="javascript":t.name.endsWith(".ts")||t.name.endsWith(".tsx")?o="typescript":t.name.endsWith(".css")?o="css":t.name.endsWith(".html")?o="html":t.name.endsWith(".json")&&(o="json"),{id:t.id,name:t.name,type:"file",content:n,language:o}})));return function(t){const e={},i=new Set;for(const o of t){const t=o.id.split("/");let e="";for(let n=0;n<t.length;n++){const o=t[n];e=e?`${e}/${o}`:o,n<t.length-1&&i.add(e)}}for(const o of i){const t=o.split("/");let i=e,n="";for(let e=0;e<t.length;e++){const o=t[e];n=n?`${n}/${o}`:o,i[o]||(i[o]={id:n,name:o,type:"folder",children:{}}),i[o].children||(i[o].children={}),i=i[o].children}}for(const o of t){const t=o.id.split("/");let i=e,n="";for(let e=0;e<t.length;e++){const r=t[e];n=n?`${n}/${r}`:r,e===t.length-1?i[r]={...o,name:r,id:n}:i=i[r].children}}function n(t){return Object.values(t).map((t=>{if("folder"===t.type){const e=n(t.children);return{...t,children:e}}return t}))}return n(e)}([...o,...r])}catch(t){return[]}}();this.root=t}getRootFileSystemItem(){return{id:"root",name:"My Computer",type:"folder",children:this.root}}readFile(t){const e=this.findItemByPath(t);return e&&"file"===e.type?e.content:void 0}writeFile(t,e){const i=this.findItemByPath(t);i&&"file"===i.type&&(i.content=e)}listDir(t){const e=this.findItemByPath(t);return e&&"folder"===e.type&&e.children?e.children:[]}deleteFile(t){}initFromData(t){this.root=t,this.initialized=!0}serialize(){return JSON.parse(JSON.stringify(this.root))}findById(t){const e=i=>{for(const n of i){if(n.id===t)return n;if(n.children){const t=e(n.children);if(t)return t}}};return e(this.root)}listChildrenById(t){const e=this.findById(t);return e&&"folder"===e.type&&e.children?e.children:[]}addItems(t,e){if(1===t.length&&"root"===t[0])return void(this.root=[...this.root,...e]);const i=this.findItemByPathArray(t);i&&"folder"===i.type&&(i.children=[...i.children||[],...e])}renameItem(t,e,i){const n=this.findItemByPathArray(t);if(n&&"folder"===n.type&&n.children){const t=n.children.find((t=>t.id===e));t&&(t.name=i)}}deleteItem(t,e){const i=this.findItemByPathArray(t);i&&"folder"===i.type&&i.children&&(i.children=i.children.filter((t=>t.id!==e)))}moveItem(t,e,i){const n=this.findItemByPathArray(t),o=this.findItemByPathArray(i);if(n&&"folder"===n.type&&n.children&&o&&"folder"===o.type){const t=n.children.find((t=>t.id===e));t&&(n.children=n.children.filter((t=>t.id!==e)),o.children=[...o.children||[],t])}}updateFileContent(t,e,i){const n=this.findItemByPathArray(t);if(n&&"folder"===n.type&&n.children){const t=n.children.find((t=>t.id===e));t&&"file"===t.type&&(t.content=i)}}findItemByPathArray(t){if(1===t.length&&"root"===t[0]){return{id:"root",name:"My Computer",type:"folder",children:this.root}}let e={id:"root",name:"My Computer",type:"folder",children:this.root};for(let i=1;i<t.length;i++){if(!e||"folder"!==e.type||!e.children)return;e=e.children.find((e=>e.id===t[i]))}return e}findItemByPath(t){if(!t||"/"===t)return{type:"folder",name:"/",id:"root",children:this.root};const e=t.split("/").filter(Boolean);let i={type:"folder",name:"/",id:"root",children:this.root};for(const n of e){if(!i||"folder"!==i.type||!i.children)return;i=i.children.find((t=>t.name===n))}return i}}const r=new o;function s(t,e){if(t.id===e)return t;if(t.children)for(const i of t.children){const t=s(i,e);if(t)return t}return null}function l(t){const e=s(d.getState().fs,t);return e&&"file"===e.type?e.content||"":null}const d=i(((t,e)=>({fs:r.getRootFileSystemItem(),init:async()=>{await r.initializeOnce(),t({fs:r.getRootFileSystemItem()})},forceReload:async()=>{await r.forceReloadFromShadow(),t({fs:r.getRootFileSystemItem()})},addItems:(e,i)=>{r.addItems(e,i);const o=r.getRootFileSystemItem();t({fs:o}),n.emit("vfs:itemsAdded",{path:e,items:i})},renameItem:(e,i,o)=>{r.renameItem(e,i,o),t({fs:r.getRootFileSystemItem()}),n.emit("vfs:itemRenamed",{path:e,id:i,newName:o})},deleteItem:(e,i)=>{r.deleteItem(e,i),t({fs:r.getRootFileSystemItem()}),n.emit("vfs:itemDeleted",{path:e,id:i})},moveItem:(e,i,o)=>{r.moveItem(e,i,o),t({fs:r.getRootFileSystemItem()}),n.emit("vfs:itemMoved",{fromPath:e,id:i,toPath:o})},updateFileContent:(e,i,o)=>{r.updateFileContent(e,i,o),t({fs:r.getRootFileSystemItem()}),n.emit("vfs:fileContentUpdated",{path:e,id:i,content:o})}}))),a=Object.freeze(Object.defineProperty({__proto__:null,getFileContent:l,useFileSystemStore:d},Symbol.toStringTag,{value:"Module"}));export{o as V,a as f,l as g,d as u,r as v};
