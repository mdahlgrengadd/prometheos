import{c as e,i as t,r as n,R as r,J as l,j as s,h as o}from"./index-CM0htoqd.js";import{aj as a,c as i,C as c,s as d,ak as u}from"./MacroContext-EXPiZfro.js";import{u as m}from"./fileSystem-D8xhFYPC.js";import{ideSettings as p}from"./esbuild-settings-Bzyyd_qg.js";import{g as h,f,b as g,d as x,c as b}from"./fileUtils-C6u6gFYx.js";import{T as v,D as y,P as w}from"./trash-2-BwW4XIOL.js";import{H as j}from"./house-DOhvFSai.js";import{F as S}from"./settings-bezY_Pyb.js";import{R as N}from"./refresh-cw-nmb9HM-A.js";import{U as C}from"./upload-C_EGovLu.js";import"./monaco-editor-Ch9pnC_y.js";import"./file-text-DxPvXGCk.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=e("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);var k={boxFlex:!0,boxFlexGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0};var F=["Webkit","ms","Moz","O"];Object.keys(k).forEach((function(e){F.forEach((function(t){k[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=k[e]}))}));var I=/^ms-/,E=/([A-Z])/g;var R={isUnitlessNumber:k}.isUnitlessNumber,P=function(e){return function(e){return e.replace(E,"-$1").toLowerCase()}(e).replace(I,"-ms-")},O=Array.isArray,$=Object.keys,M=/^(normal|none|(\b(url\([^)]*\)|chapter_counter|attr\([^)]*\)|(no-)?(open|close)-quote|inherit)((\b\s*)|$|\s+))+)$/;function A(e,t){return R[e]||"number"!=typeof t?"content"!==e||M.test(t)||(t="'"+t.replace(/'/g,"\\'")+"'"):t+="px",P(e)+": "+t+";  "}const L=t((function(e){var t="";if(!e||0===$(e).length)return t;for(var n=$(e),r=0,l=n.length;r<l;r++){var s=n[r],o=e[s];if(O(o))for(var a=0,i=o.length;a<i;a++)t+=A(s,o[a]);else t+=A(s,o)}return t}));function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},T.apply(this,arguments)}const B=["style"],z=n.forwardRef(((e,t)=>{let{style:s={}}=e,o=function(e,t){if(null==e)return{};var n,r,l={},s=Object.keys(e);for(r=0;r<s.length;r++)t.indexOf(n=s[r])>=0||(l[n]=e[n]);return l}(e,B);const a=n.useRef(null),i=n.useRef(null),[,c]=n.useState(0);return n.useImperativeHandle(t,(()=>({getBoundingClientRect:()=>{var e;return null==(e=a.current)?void 0:e.getBoundingClientRect()},getParentBoundingClientRect:()=>{var e,t;return null==a||null==(e=a.current)||null==(t=e.parentElement)?void 0:t.getBoundingClientRect()},drawSelectionBox:e=>{requestAnimationFrame((()=>{if(i.current){const t=T({border:"1px solid #4C85D8",background:"rgba(155, 193, 239, 0.4)",position:"absolute",pointerEvents:"none"},s,{top:e.top,left:e.left,width:e.width,height:e.height});i.current.style.cssText=L(t)}}))},clearSelectionBox:()=>{requestAnimationFrame((()=>{i.current&&(i.current.style.cssText=L({top:0,left:0,width:0,height:0}))}))}}))),n.useEffect((()=>{c((e=>e+1))}),[]),r.createElement("div",{ref:a},a.current?l.createPortal(r.createElement("div",T({ref:i},o)),a.current):null)}));function U(e){return(t=e).width*t.height>10;var t}const W=["txt","js","jsx","ts","tsx","md","css","html","json","csv","xml","yml","yaml","py","c","h","cpp","cc","hpp"],K=({position:e,itemId:t,onRename:n,onDelete:r,onCreateShortcut:l,setShowContextMenu:o})=>s.jsxs("div",{className:"fixed bg-white border border-gray-200 rounded-lg shadow-xl py-2 z-50 min-w-48",style:{left:e.x,top:e.y},children:[s.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 transition-colors",onClick:e=>{e.stopPropagation(),n(t),o(null)},children:[s.jsx(D,{className:"w-4 h-4"}),"Rename"]}),l&&s.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 transition-colors",onClick:e=>{e.stopPropagation(),l(t),o(null)},children:[s.jsx(a,{className:"w-4 h-4"}),"Create Desktop Shortcut"]}),s.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 text-red-600 hover:bg-red-50 transition-colors",onClick:e=>{e.stopPropagation(),r(t)},children:[s.jsx(v,{className:"w-4 h-4"}),"Delete"]})]}),q=({title:e,inputValue:t,onInputChange:n,onCancel:r,onKeyDown:l,children:o})=>s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:e}),s.jsx("input",{type:"text",value:t,onChange:n,onKeyDown:l,placeholder:"Enter name...",className:"w-full px-3 py-2 border border-gray-300 rounded-md mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),o]})]})}),H=({newItemName:e,setNewItemName:t,setShowNewItemDialog:n,createNewItem:r,handleKeyDown:l})=>s.jsxs(q,{title:"Create New Item",inputValue:e,onInputChange:e=>t(e.target.value),onCancel:()=>{n(!1),t("")},onKeyDown:l,children:[s.jsx("button",{onClick:()=>r("folder"),disabled:!e.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Create Folder"}),s.jsx("button",{onClick:()=>r("file"),disabled:!e.trim(),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Create File"})]}),V=({newItemName:e,setNewItemName:t,setShowRenameDialog:n,renameItem:r,showRenameDialog:l})=>s.jsx(q,{title:"Rename Item",inputValue:e,onInputChange:e=>t(e.target.value),onCancel:()=>{n(null),t("")},onKeyDown:s=>{"Enter"===s.key&&e.trim()?r(l,e):"Escape"===s.key&&(n(null),t(""))},children:s.jsx("button",{onClick:()=>r(l,e),disabled:!e.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})}),_=({items:e,selectedItems:t,setSelectedItems:n,navigateToFolder:l,setShowContextMenu:o,handleDragStart:a,handleFolderDragOver:i,handleFolderDragLeave:c,handleFolderDrop:d,dragOverFolder:u,selectionBox:m,openFile:p})=>s.jsx("div",{className:"mb-8",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"1rem",alignItems:"start"},children:e.map((m=>s.jsx("div",{"data-item-id":m.id,className:`p-3 border rounded-lg cursor-pointer hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ${t.has(m.id)?"bg-blue-50 border-blue-300 shadow-sm":"border-gray-200"} ${u===m.id?"bg-blue-100 border-blue-400":""}`,onClick:r=>{if(r.stopPropagation(),r.ctrlKey||r.metaKey){const e=new Set(t);e.has(m.id)?e.delete(m.id):e.add(m.id),n(e)}else if(r.shiftKey&&t.size>0){const r=e.map((e=>e.id)),l=Array.from(t).pop(),s=r.indexOf(l||""),o=r.indexOf(m.id);if(s>=0){const e=Math.min(s,o),t=Math.max(s,o),l=r.slice(e,t+1);n(new Set(l))}}else n(new Set([m.id]))},onDoubleClick:e=>{e.stopPropagation(),"folder"===m.type&&m.name.endsWith(".exe")?p&&p(m):"folder"===m.type?l(m.id):"file"===m.type&&p&&p(m)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),t.has(m.id)||n(new Set([m.id])),o({x:e.clientX,y:e.clientY,itemId:m.id})},draggable:!0,onDragStart:e=>a&&a(m.id,e),onDragOver:e=>"folder"===m.type&&i&&i(m.id,e),onDragLeave:()=>"folder"===m.type&&c&&c(),onDrop:e=>"folder"===m.type&&d&&d(m.id,e),children:s.jsxs("div",{className:"flex flex-col items-center text-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center mb-2",children:r.cloneElement(h(m),{className:"w-8 h-8 "+(t.has(m.id)?"drop-shadow-sm":"")})}),s.jsx("span",{className:"text-sm truncate w-full font-medium",title:m.name,children:m.name}),"file"===m.type&&void 0!==m.size&&s.jsx("span",{className:"text-xs text-gray-500 mt-1",children:f(m.size)})]})},m.id)))}),G=({fileSystem:e,expandedFolders:t,selectedItems:r,navigateToQuickAccess:l,toggleFolder:o,setSelectedItems:a,handleFolderDragOver:d,handleFolderDragLeave:u,handleFolderDrop:m,dragOverFolder:f})=>{const g=n.useMemo((()=>{var t;return null==(t=e.children)?void 0:t.find((e=>".vfsignore"===e.name&&"file"===e.type))}),[e]),x=n.useMemo((()=>g&&g.content?g.content.split(/\r?\n/).map((e=>e.trim())).filter((e=>e&&!e.startsWith("#"))):[]),[g]),b=n.useMemo((()=>x.map((e=>{const t=e.endsWith("/");let n=(t?e.slice(0,-1):e).replace(/\*\*/g,".*").replace(/\*/g,"[^/]*").replace(/\?/g,".");return t&&(n=`${n}(/.*)?`),new RegExp(`^${n}$`)}))),[x]),v=n.useCallback((e=>e.filter((e=>".vfsignore"!==e.name&&(!(!p.showHiddenFiles&&e.name.startsWith("."))&&!b.some((t=>t.test(e.id)))))).sort(((e,t)=>e.type!==t.type?"folder"===e.type?-1:1:e.name.localeCompare(t.name)))),[b]),w=(e,n=0)=>{const p=t.has(e.id),g=r.has(e.id),x="folder"===e.type&&e.children&&e.children.length>0,b=f===e.id;return s.jsxs("div",{children:[s.jsxs("div",{className:`flex items-center gap-2 py-1 px-2 hover:bg-gray-100 cursor-pointer transition-colors ${g?"bg-blue-100 text-blue-700":""} ${b?"bg-blue-100 border-blue-400":""}`,style:{paddingLeft:20*n+4+"px"},onClick:()=>{"folder"===e.type&&(o(e.id),a(new Set([e.id])))},onDoubleClick:()=>{"folder"===e.type&&l(e.id)},onDragOver:t=>"folder"===e.type&&d&&d(e.id,t),onDragLeave:()=>"folder"===e.type&&u&&u(),onDrop:t=>"folder"===e.type&&m&&m(e.id,t),children:["folder"===e.type&&s.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:x?p?s.jsx(i,{className:"w-3 h-3 text-gray-500"}):s.jsx(c,{className:"w-3 h-3 text-gray-500"}):s.jsx("div",{className:"w-3 h-3"})}),h(e),s.jsx("span",{className:"text-sm truncate flex-1",children:e.name})]}),"folder"===e.type&&p&&e.children&&s.jsx("div",{children:v(e.children).map((e=>w(e,n+1)))})]},e.id)};return s.jsxs("div",{className:"w-64 bg-gray-50 border-r border-gray-200 overflow-y-auto",children:[s.jsxs("div",{className:"p-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Quick Access"}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("button",{onClick:()=>l("desktop"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:e=>d&&d("desktop",e),onDragLeave:()=>u&&u(),onDrop:e=>m&&m("desktop",e),children:[s.jsx(j,{className:"w-4 h-4 text-blue-500"}),"Desktop"]}),s.jsxs("button",{onClick:()=>l("documents"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:e=>d&&d("documents",e),onDragLeave:()=>u&&u(),onDrop:e=>m&&m("documents",e),children:[s.jsx(S,{className:"w-4 h-4 text-blue-500"}),"Documents"]}),s.jsxs("button",{onClick:()=>l("downloads"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:e=>d&&d("downloads",e),onDragLeave:()=>u&&u(),onDrop:e=>m&&m("downloads",e),children:[s.jsx(y,{className:"w-4 h-4 text-blue-500"}),"Downloads"]})]})]}),s.jsxs("div",{className:"px-4 pb-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"This PC"}),s.jsx("div",{className:"text-sm",children:w(e)})]})]})},Y=({currentPath:e,breadcrumbs:t,navigateUp:n,navigateToPathLevel:r,showNewItemDialog:l,fileInputRef:o,isAuthenticated:a,handleGithubAuth:i})=>s.jsxs("div",{className:"h-12 bg-gray-50 border-b border-gray-200 flex items-center px-4 gap-2",children:[s.jsx("button",{onClick:n,disabled:e.length<=1,className:"p-2 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Go up",children:s.jsx(c,{className:"w-4 h-4 rotate-180"})}),s.jsx("button",{className:"p-2 hover:bg-gray-200 rounded transition-colors",title:"Refresh",children:s.jsx(N,{className:"w-4 h-4"})}),s.jsx("div",{className:"flex-1 mx-4",children:s.jsxs("div",{className:"flex items-center bg-white border border-gray-300 rounded px-3 py-1.5",children:[s.jsx(j,{className:"w-4 h-4 text-gray-400 mr-2"}),s.jsx("button",{onClick:()=>r(0),className:"text-sm hover:text-blue-600 transition-colors",children:"This PC"}),t.map(((e,t)=>s.jsxs("span",{className:"flex items-center",children:[s.jsx(c,{className:"w-3 h-3 text-gray-400 mx-1"}),s.jsx("button",{onClick:()=>r(t+1),className:"text-sm text-gray-600 hover:text-blue-600 transition-colors",children:e.name})]},e.id)))]})}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs("button",{onClick:()=>a?l():i(),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm transition-colors disabled:opacity-50",title:a?"Create new item":"Sign in to create items",children:[s.jsx(w,{className:"w-4 h-4"}),"New"]}),s.jsx("button",{onClick:()=>{var e;return a?null==(e=o.current)?void 0:e.click():i()},className:"p-2 hover:bg-gray-200 rounded transition-colors",title:a?"Upload files":"Sign in to upload files",children:s.jsx(C,{className:"w-4 h-4"})})]})]}),Q=()=>{var e,t;const[l,a]=n.useState(["root"]),[i,c]=n.useState(new Set),[u,h]=n.useState(new Set(["root"])),[f,v]=n.useState(!1),[y,w]=n.useState(null),[j,N]=n.useState(null),[C,D]=n.useState(!1),[k,F]=n.useState(null),[I,E]=n.useState(""),[R,P]=n.useState(null),[O,$]=n.useState(null),[M,A]=n.useState(null),[L,B]=n.useState(!1),[q,Q]=n.useState(!1),[J,X]=n.useState(!1),Z=n.useRef(null),ee=n.useRef(null),te=m((e=>e.fs)),ne=m((e=>e.init)),re=m((e=>e.addItems)),le=m((e=>e.renameItem)),se=m((e=>e.deleteItem)),oe=m((e=>e.moveItem)),ae=d(),ie=n.useMemo((()=>{var e;return null==(e=te.children)?void 0:e.find((e=>".vfsignore"===e.name&&"file"===e.type))}),[te]),ce=n.useMemo((()=>ie&&ie.content?ie.content.split(/\r?\n/).map((e=>e.trim())).filter((e=>e&&!e.startsWith("#"))):[]),[ie]),de=n.useMemo((()=>ce.map((e=>{const t=e.endsWith("/");let n=(t?e.slice(0,-1):e).replace(/\*\*/g,".*").replace(/\*/g,"[^/]*").replace(/\?/g,".");return t&&(n=`${n}(/.*)?`),new RegExp(`^${n}$`)}))),[ce]),ue=n.useMemo((()=>{var e;let t=te;for(let n=1;n<l.length&&(t=null==(e=t.children)?void 0:e.find((e=>e.id===l[n])),t);n++);return((null==t?void 0:t.children)||[]).filter((e=>".vfsignore"!==e.name&&(!(!p.showHiddenFiles&&e.name.startsWith("."))&&!de.some((t=>t.test(e.id))))))}),[te,l,de]),me=n.useMemo((()=>[...ue].sort(((e,t)=>e.type!==t.type?"folder"===e.type?-1:1:e.name.localeCompare(t.name)))),[ue]);n.useEffect((()=>{ne().then((()=>h(new Set(["root"])))),f||je()}),[ne,f]);const{DragSelection:pe}=function(e){const{onSelectionChange:t,onSelectionEnd:l,onSelectionStart:s,isEnabled:o=!0,selectionProps:a={},eventsElement:i,shouldStartSelecting:c,isValidSelectionStart:d}=e||{},u=n.useRef(null),{cancelCurrentSelection:m}=function({containerRef:e,onSelectionChange:t,onSelectionStart:r,onSelectionEnd:l,isEnabled:s=!0,eventsElement:o,shouldStartSelecting:a,isValidSelectionStart:i=U}){const c=n.useRef(null),d=n.useRef(null),u=n.useRef(!1),m=n.useRef(t),p=n.useRef(r),h=n.useRef(l),f=n.useRef(),g=n.useRef(s);m.current=n.useCallback((e=>{f.current=t?requestAnimationFrame((()=>{t(e)})):void 0}),[t]),p.current=r,h.current=l,g.current=s;const x=n.useCallback((()=>{var t;c.current=null,d.current=null,u.current=!1,null==(t=e.current)||t.clearSelectionBox(),"number"==typeof f.current&&cancelAnimationFrame(f.current)}),[e]),b=n.useCallback(((t,n)=>{var r,l,s;return n||(n=null==(s=e.current)?void 0:s.getParentBoundingClientRect()),{x:t.clientX-("number"==typeof(null==(r=n)?void 0:r.left)?n.left:0),y:t.clientY-("number"==typeof(null==(l=n)?void 0:l.top)?n.top:0)}}),[e]),v=n.useCallback(((t,n)=>{if(c.current&&d.current){if(!n)return;const l=(({startPoint:e,endPoint:t})=>({left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}))({startPoint:c.current,endPoint:d.current}),s=T({},l,{top:l.top+((null==n?void 0:n.top)||0),left:l.left+((null==n?void 0:n.left)||0)});var r;i(l)?(u.current||(null!=p&&p.current&&p.current(t),u.current=!0),null==(r=e.current)||r.drawSelectionBox(l),null==m.current||m.current(s)):u.current&&(null==m.current||m.current(s))}else x()}),[x,e]),y=n.useCallback((t=>{var n;if(!c.current)return;const r=null==(n=e.current)?void 0:n.getParentBoundingClientRect();d.current=b(t,r),v(t,r)}),[v,b,e]),w=n.useCallback((e=>{var t;0===e.button&&(d.current&&(null==h.current||h.current(e)),x(),document.body.style.removeProperty("user-select"),document.body.style.removeProperty("-webkit-user-select"),(o||document.body).removeEventListener("mousemove",y),null==(t=window)||t.removeEventListener("mouseup",w))}),[o,x,y]),j=n.useCallback((e=>{if(0===e.button&&g.current){var t;if("function"==typeof a&&!a(e.target))return;document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",c.current=b(e),(o||document.body).addEventListener("mousemove",y),null==(t=window)||t.addEventListener("mouseup",w)}}),[o,b,y,w]);return n.useEffect((()=>((o||document.body).addEventListener("mousedown",j),()=>{(o||document.body).removeEventListener("mousedown",j),(o||document.body).removeEventListener("mousemove",y),window.removeEventListener("mouseup",w)})),[o,j,y,w]),{cancelCurrentSelection:x}}({containerRef:u,onSelectionEnd:l,onSelectionStart:s,onSelectionChange:t,isEnabled:o,eventsElement:i,shouldStartSelecting:c,isValidSelectionStart:d});return{cancelCurrentSelection:m,DragSelection:n.useCallback((()=>r.createElement(z,T({ref:u},a))),[])}}({onSelectionChange:function(e){if(!ee.current||!e.width||!e.height)return;A(e);const t=ee.current.querySelectorAll("[data-item-id]"),n=new Set;t.forEach((t=>{const r=t.getBoundingClientRect(),l=t.getAttribute("data-item-id");if(!l)return;const s=ee.current.getBoundingClientRect(),o=r.left-s.left,a=r.top-s.top,i=r.right-s.left,c=r.bottom-s.top;!(i<e.left||o>e.left+e.width||c<e.top||a>e.top+e.height)&&n.add(l)})),c(n)},isEnabled:q,shouldStartSelecting:e=>{if(e instanceof HTMLElement){let t=e;for(;t&&t!==ee.current;){if(t.hasAttribute("data-item-id"))return!1;t=t.parentElement}return!0}return!1},selectionProps:{style:{border:"2px solid #3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",position:"absolute",zIndex:1e3}}}),he=n.useCallback((e=>{var t;let n=te;for(let r=1;r<e.length;r++){const l=null==(t=n.children)?void 0:t.find((t=>t.id===e[r]));if(!l)return null;n=l}return n}),[te]),fe=n.useCallback((()=>he(l)),[he,l]),ge=n.useCallback((e=>{const t=[...l,e];a(t),c(new Set),h((t=>new Set([...t,e])))}),[l]),xe=n.useCallback((()=>{l.length>1&&(a(l.slice(0,-1)),c(new Set))}),[l]),be=n.useCallback((e=>{const t=l.slice(0,e+1);a(t),c(new Set)}),[l]),ve=n.useCallback((e=>{h((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))}),[]),ye=n.useCallback((async e=>{if("file"!==e.type&&("folder"!==e.type||!e.name.endsWith(".exe")))return;if("folder"===e.type&&e.name.endsWith(".exe")){try{const t=`app://PublishedApps/${e.name}`;await(null==ae?void 0:ae.executeAction("sys","open",{name:"app-preview",initFromUrl:t})),o(`Opening published app: ${e.name}`)}catch(n){o(`Failed to open ${e.name}`)}return}const t=g(e.name);if(t)try{const n=`vfs://${e.id}`;await(null==ae?void 0:ae.executeAction("sys","open",{name:t,initFromUrl:n})),o(`Opening ${e.name} with ${t}`)}catch(n){o(`Failed to open ${e.name}`)}else o(`No default app for file type: ${e.name.split(".").pop()}`)}),[ae]);const we=e=>{if(!I.trim()||!f)return;const t={id:`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:I.trim(),type:e,..."folder"===e?{children:[]}:{size:0}};re(l,[t]),o.success(("folder"===e?"Folder":"File")+" created"),E(""),D(!1)},je=()=>{v(!0),w({login:"developer-user",avatar_url:"https://github.com/github.png",name:"Developer User"})},Se=(e,t)=>{t.preventDefault(),t.stopPropagation(),O&&O!==e&&(P(e),t.dataTransfer.dropEffect="move")},Ne=()=>{P(null)},Ce=(e,t)=>{var n,r;if(t.preventDefault(),t.stopPropagation(),P(null),!O||!f)return;if(O===e)return;const s=x(te,e);if(!s)return;const a="Desktop"===e||s.includes("Desktop")||"Desktop"===s[s.length-1],i=null==(n=null==De?void 0:De.children)?void 0:n.find((e=>e.id===O));if(!a&&i&&["test.md","test.txt","package.json","package-lock.json",".vfsignore"].includes(i.name))o.error(`Cannot move system file: ${i.name}`,{description:"Files loaded from the shadow filesystem are protected and cannot be moved. You can copy them to Desktop instead."});else{if(a){const e=null==(r=null==De?void 0:De.children)?void 0:r.find((e=>e.id===O));if(e){const t=he(s),n=(null==t?void 0:t.children)||[],r=b(e,n);re(s,[r]),o.success(`Copied to Desktop as ${r.name}`)}}else oe(l,O,s);$(null)}},De=fe(),ke=l.slice(1).reduce(((e,t,n)=>{const r=l.slice(0,n+2),s=he(r);return s&&e.push({id:t,name:s.name,path:r}),e}),[]);return s.jsxs("div",{className:"h-screen flex flex-col bg-white",onClick:()=>{N(null)},children:[s.jsx(Y,{currentPath:l,breadcrumbs:ke,navigateUp:xe,navigateToPathLevel:be,showNewItemDialog:()=>D(!0),fileInputRef:Z,isAuthenticated:f,handleGithubAuth:je}),s.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[s.jsx(G,{fileSystem:te,expandedFolders:u,selectedItems:i,navigateToQuickAccess:e=>{const t=x(te,e);t&&(a(t),c(new Set))},toggleFolder:ve,setSelectedItems:c,handleFolderDragOver:Se,handleFolderDragLeave:Ne,handleFolderDrop:Ce,dragOverFolder:R}),s.jsxs("div",{className:"flex-1 p-6 overflow-y-auto bg-white transition-colors duration-200 relative border-2 border-dashed "+(J?"border-blue-400 bg-blue-50":"border-transparent"),onDragEnter:e=>{e.preventDefault(),X(!0)},onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy",X(!0)},onDragLeave:e=>{e.preventDefault(),X(!1)},onDrop:async e=>{var t;e.preventDefault(),X(!1);const n=Array.from(e.dataTransfer.files);if(n.length>0&&!f&&(je(),o.success("Auto-authenticated for file upload")),n.length>0)try{const e=[];for(const r of n){const n=(null==(t=r.name.split(".").pop())?void 0:t.toLowerCase())??"";let l;l=W.includes(n)?await new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=()=>t(n.error),n.readAsText(r)})):"[Binary file content]",e.push({id:`file_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,name:r.name,type:"file",size:r.size,content:l})}re(l,e),o.success(`${e.length} file(s) uploaded`)}catch(r){o.error("Failed to upload files")}},onMouseDown:e=>{if(e.target===ee.current||e.target===e.currentTarget)Q(!0);else{let t=e.target,n=!1;for(;t&&t!==ee.current;){if(t.hasAttribute("data-item-id")){n=!0;break}t=t.parentElement}n||Q(!0)}B(!0)},onMouseUp:()=>{B(!1),Q(!1),A(null)},ref:ee,children:[s.jsx(pe,{}),De&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-1",children:De.name}),s.jsxs("p",{className:"text-sm text-gray-500",children:[(null==(e=De.children)?void 0:e.length)||0," item",1!==((null==(t=De.children)?void 0:t.length)||0)?"s":""]})]}),me.length>0?s.jsx(_,{items:me,selectedItems:i,setSelectedItems:c,navigateToFolder:ge,setShowContextMenu:N,handleDragStart:(e,t)=>{t.stopPropagation(),f&&($(e),t.dataTransfer.setData("text/plain",e),t.dataTransfer.setData("application/vfs-item",JSON.stringify({itemId:e,currentPath:l,action:"copy"})),t.dataTransfer.effectAllowed="copyMove",i.has(e)||c(new Set([e])))},handleFolderDragOver:Se,handleFolderDragLeave:Ne,handleFolderDrop:Ce,dragOverFolder:R,selectionBox:M,openFile:ye}):s.jsxs("div",{className:"text-center text-gray-500 mb-8",children:[s.jsx(S,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"This folder is empty"})]})]})]})]}),s.jsx("input",{type:"file",ref:Z,multiple:!0,className:"hidden",onChange:e=>{Array.from(e.target.files||[])}}),j&&s.jsx(K,{position:{x:j.x,y:j.y},itemId:j.itemId,onRename:e=>{var t;const n=null==(t=null==De?void 0:De.children)?void 0:t.find((t=>t.id===e));n&&(E(n.name),F(e))},onDelete:e=>{var t;if(!f)return;const n=null==(t=null==De?void 0:De.children)?void 0:t.find((t=>t.id===e));n&&["Documents","Downloads","Desktop","package.json","package-lock.json",".vfsignore"].includes(n.name)?o.error(`Cannot delete system file: ${n.name}`,{description:"Files loaded from the shadow filesystem are protected and cannot be deleted."}):(se(l,e),o.success("Item deleted"),c(new Set),N(null))},setShowContextMenu:N}),C&&s.jsx(H,{newItemName:I,setNewItemName:E,setShowNewItemDialog:D,createNewItem:we,handleKeyDown:e=>{"Enter"===e.key&&C&&I.trim()?we("folder"):"Escape"===e.key&&(D(!1),F(null),N(null))}}),k&&s.jsx(V,{newItemName:I,setNewItemName:E,setShowRenameDialog:F,renameItem:(e,t)=>{t.trim()&&f&&(le(l,e,t.trim()),o.success("Item renamed"),F(null),E(""))},showRenameDialog:k})]})},J={id:u.id,manifest:u,init:async()=>{},render:()=>s.jsx(Q,{}),onOpen:()=>{},onClose:()=>{}};export{J as default};
