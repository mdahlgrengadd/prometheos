import{c as k,r as m,a as C,j as e,e as F}from"./index-D-dJ6MFG.js";import{u as L,a as E,C as q,A as z,M as R,P as $}from"./MacroContext-DNX_Eazx.js";import{H as S}from"./house-WsJQWdRe.js";import"./monaco-editor-Dq6WuQlL.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=k("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=k("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=k("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),B=({setActiveApp:a})=>{const{pluginManager:i,openWindow:s}=L();return m.useEffect(()=>{const n=E();if(console.log("Mobile: Apps to open from URL:",n),n.length>0){const r=n[0];console.log("Mobile: Attempting to open app:",r);const d=setTimeout(()=>{try{s(r),a(r),console.log(`Mobile: Successfully opened ${r}`)}catch(u){console.warn(`Mobile: Failed to open ${r}:`,u)}},10);return()=>clearTimeout(d)}},[a,i,s]),m.useEffect(()=>{const n=()=>{const r=E();if(r.length>0){const d=r[0];s(d),a(d)}};return window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[a,s]),null},I=({plugin:a,closeApp:i})=>{const{padding:s}=C();return a?e.jsxs("div",{className:"fixed inset-0 z-50 bg-white animate-fade-in flex flex-col",children:[e.jsxs("div",{className:"mobile-app-header px-4 py-3 flex items-center bg-gradient-to-r from-purple-500 to-blue-600",children:[e.jsx("button",{onClick:i,className:"p-1 rounded-full bg-white/20 transition-transform active:scale-90","aria-label":"Back to home screen",children:e.jsx(A,{className:"text-white",size:20})}),e.jsx("h1",{className:"ml-4 text-white font-semibold text-xl",children:a.manifest.name})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"window-content h-full",style:{minHeight:"100%",paddingTop:`${s}px`,paddingRight:`${s}px`,paddingBottom:`${s}px`,paddingLeft:`${s}px`},children:a.render()})})]}):null},D=({plugins:a,activeApp:i,openApp:s})=>e.jsxs("div",{className:"fixed bottom-0 inset-x-0 h-20 bg-black/10 backdrop-blur-md z-50 flex items-center justify-around px-6",children:[e.jsx("button",{className:"flex flex-col items-center justify-center",onClick:()=>i&&s(i),children:e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${i?"bg-white/10":"bg-white/20"}`,children:e.jsx(S,{size:24,className:`${i?"text-white/70":"text-white"}`})})}),a.map(n=>e.jsx("button",{className:"flex flex-col items-center justify-center",onClick:()=>s(n.id),children:e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${i===n.id?"bg-white/20":"bg-white/10"}`,children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center",children:typeof n.manifest.icon=="string"?e.jsx("span",{className:"text-white font-medium text-xs",children:n.manifest.name.substring(0,2)}):e.jsx("div",{className:"text-white scale-75",children:n.manifest.icon})})})},n.id)),e.jsx("button",{className:"flex flex-col items-center justify-center",onClick:()=>i&&s(i),children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center",children:e.jsx(U,{size:24,className:"text-white/70"})})})]}),W=({plugins:a,pluginPages:i,currentHomeScreen:s,setCurrentHomeScreen:n,openApp:r})=>{const[d,u]=m.useState(null),[j,g]=m.useState(null),v=h=>{u(h.targetTouches[0].clientX)},f=h=>{g(h.targetTouches[0].clientX)},p=()=>{if(!d||!j)return;const h=d-j,x=h>50,o=h<-50;x&&s<i.length-1&&n(s+1),o&&s>0&&n(s-1),u(null),g(null)},P=()=>{s<i.length-1&&n(s+1)},y=()=>{s>0&&n(s-1)};return e.jsxs("div",{className:"relative h-full w-full flex flex-col",onTouchStart:v,onTouchMove:f,onTouchEnd:p,children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-white/20 rounded-full"}),e.jsx("div",{className:"w-4 h-4 bg-white/20 rounded-full"}),e.jsx("div",{className:"w-4 h-4 bg-white/20 rounded-full"})]})]}),e.jsx("div",{className:"flex-grow flex items-center justify-center pb-16",children:(()=>{const x=s*9,o=x+9,l=a.slice(x,o),N=l.length<9?[...l,...Array(9-l.length).fill(null)]:l;return e.jsx("div",{className:"grid grid-cols-3 gap-4 p-4 overflow-y-auto",children:N.map((t,w)=>{var c,b,M,T;return e.jsxs("div",{className:"flex flex-col items-center",onClick:()=>t&&t.id&&r(t.id),style:{cursor:t&&t.id?"pointer":"default",opacity:t&&t.id?1:.5},children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-sm",children:e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-lg flex items-center justify-center overflow-hidden",children:(c=t==null?void 0:t.manifest)!=null&&c.icon?t.manifest.icon:(b=t==null?void 0:t.manifest)!=null&&b.iconUrl?e.jsx("img",{src:t.manifest.iconUrl,alt:t.manifest.name||"App",className:"w-8 h-8 object-contain",draggable:!1}):(M=t==null?void 0:t.manifest)!=null&&M.name?e.jsx("span",{className:"text-white font-bold",children:t.manifest.name.charAt(0)}):t!=null&&t.id?e.jsx("span",{className:"text-white font-bold",children:t.id.charAt(0).toUpperCase()}):e.jsx("span",{className:"text-white font-bold opacity-50",children:"?"})})}),e.jsx("span",{className:"mt-2 text-xs text-white font-medium text-center max-w-[4.5rem] truncate",children:((T=t==null?void 0:t.manifest)==null?void 0:T.name)||(t==null?void 0:t.id)||""})]},(t==null?void 0:t.id)??w)})})})()}),e.jsx("div",{className:"flex justify-center pb-24",children:e.jsx("div",{className:"flex space-x-2",children:i.map((h,x)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${x===s?"bg-white":"bg-white/30"}`},x))})}),i.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-y-0 left-2 flex items-center sm:hidden",children:s>0&&e.jsx("button",{onClick:y,className:"p-2 rounded-full bg-white/20 backdrop-blur-sm",children:e.jsx(O,{className:"text-white"})})}),e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center sm:hidden",children:s<i.length-1&&e.jsx("button",{onClick:P,className:"p-2 rounded-full bg-white/20 backdrop-blur-sm",children:e.jsx(q,{className:"text-white"})})})]})]})},G=({activeApp:a,setActiveApp:i})=>{const{loadedPlugins:s,pluginManager:n,openWindow:r}=L(),{wallpaper:d,backgroundColor:u}=C(),[j,g]=m.useState(0),v=F(o=>o.windows);m.useEffect(()=>{const o=document.createElement("meta");o.name="viewport",o.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover",document.head.appendChild(o);const l=()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)};return window.addEventListener("resize",l),window.addEventListener("orientationchange",l),l(),()=>{document.head.removeChild(o),window.removeEventListener("resize",l),window.removeEventListener("orientationchange",l)}},[]);const f=m.useMemo(()=>{const o=n.getAllPlugins()||[],l=Array.isArray(s)?s:Object.values(s||{}),N=Object.values(v||{}).map(c=>({id:c.id,manifest:{name:c.title,icon:c.icon,iconUrl:typeof c.icon=="string"?c.icon:void 0}})),t=[...o,...l,...N],w=new Map;return t.forEach(c=>{if(c&&c.id){const b=w.get(c.id);(!b||!b.manifest&&c.manifest)&&w.set(c.id,c)}}),Array.from(w.values())},[n,s,v]);console.log("Available plugins (combined sources):",f.length,f.map(o=>o.id+(o.manifest?" (has manifest)":" (no manifest)")));const p=8,P=m.useMemo(()=>{const o=[];for(let l=0;l<f.length;l+=p)o.push(f.slice(l,l+p));return o.length>0?o:[[]]},[f]),y=o=>{console.log("Opening app:",o),r(o),i(o)},h=()=>{i(null)},x=d?{backgroundImage:`url(${d})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{backgroundColor:u};return e.jsxs("div",{className:"relative w-full h-screen overflow-auto",style:{height:"var(--app-height, 100vh)",...x},children:[!a&&e.jsx(W,{plugins:f,pluginPages:P,currentHomeScreen:j,setCurrentHomeScreen:g,openApp:y}),a&&e.jsx(I,{plugin:s.find(o=>o.id===a),closeApp:h}),e.jsx("div",{style:{opacity:a?0:1,visibility:a?"hidden":"visible",transition:"opacity 0.3s ease, visibility 0.3s ease",zIndex:a?10:50},children:e.jsx(D,{plugins:f.slice(0,4),activeApp:a,openApp:y})})]})},X=()=>{const a="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return a&&i},_=()=>{const[a,i]=m.useState(null);return m.useEffect(()=>{if(!X()){console.log("Fullscreen request skipped - not a mobile device");return}const s=async()=>{try{const n=document.documentElement;n.requestFullscreen?await n.requestFullscreen():n.webkitRequestFullscreen?await n.webkitRequestFullscreen():n.mozRequestFullScreen?await n.mozRequestFullScreen():n.msRequestFullscreen&&await n.msRequestFullscreen()}catch(n){console.warn("Fullscreen request failed:",n)}};setTimeout(()=>{s()},1e3)},[]),e.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[e.jsx(B,{setActiveApp:i}),e.jsx(G,{activeApp:a,setActiveApp:i})]})},Y=()=>e.jsx(z,{children:e.jsx(R,{children:e.jsx($,{children:e.jsx(_,{})})})});export{Y as default};
